<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>乙物語 ～ Otsumonogatari ～</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<header><h1>乙物語 ～ Otsumonogatari ～</h1><hr></header>
<main class="container mt-4">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flashes alert alert-info">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
</main>
<footer>
    <hr>
    <small>乙物語 ～ Otsumonogatari ～</small>
    <!-- Bootstrap JS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlHash = window.location.hash;

        if (urlHash) {
            const triggerEl = document.querySelector(`button[data-bs-target="${urlHash}"]`);
            
            if (triggerEl) {
                // BootstrapのTab APIを使用してタブをアクティブ化
                if (typeof bootstrap !== 'undefined' && bootstrap.Tab) {
                    const tab = new bootstrap.Tab(triggerEl);
                    tab.show();
                    console.log(`DEBUG JS: Tab activated by Bootstrap API for hash: ${urlHash}`);
                } else {
                    // Bootstrap APIが利用できない場合のフォールバック
                    console.log(`DEBUG JS: Bootstrap Tab API not found, falling back to manual DOM manipulation for hash: ${urlHash}`);
                    const activeTab = document.querySelector('.nav-tabs .nav-link.active');
                    const activePane = document.querySelector('.tab-content .tab-pane.show.active');
                    if (activeTab) {
                        activeTab.classList.remove('active');
                        activeTab.setAttribute('aria-selected', 'false');
                    }
                    if (activePane) {
                        activePane.classList.remove('show', 'active');
                    }

                    triggerEl.classList.add('active');
                    triggerEl.setAttribute('aria-selected', 'true');
                    const targetPaneId = triggerEl.getAttribute('data-bs-target');
                    const targetPane = document.querySelector(targetPaneId);
                    if (targetPane) {
                        targetPane.classList.add('show', 'active');
                    }
                }
            } else {
                console.log(`DEBUG JS: No tab button found for hash: ${urlHash}`);
            }
        } else {
            console.log("DEBUG JS: No URL hash found.");
        }
    });
    </script>
</footer>
</body>
</html>
